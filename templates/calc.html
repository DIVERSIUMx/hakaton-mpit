{% extends "base.html" %}

{% block content %}
<section class="calculator-hero">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-12">
        <div class="text-center mb-5 reveal">
          <h1 class="section-title">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ï–ì–≠ –í–ì–£</h1>
          <p class="muted mb-4" style="font-size: 1.2rem;">–£–∑–Ω–∞–π—Ç–µ, –Ω–∞ –∫–∞–∫–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –≤—ã –º–æ–∂–µ—Ç–µ
            –ø–æ—Å—Ç—É–ø–∏—Ç—å —Å –≤–∞—à–∏–º–∏ –±–∞–ª–ª–∞–º–∏ –ï–ì–≠</p>
          <div class="accent-underline"></div>
        </div>
      </div>

      <div class="col-lg-10 col-xl-8">
        <div class="glass-card reveal">
          <form id="egeCalculatorForm">
            <div class="row">
              <div class="col-md-6 mb-4">
                <div class="subject-header">üìö –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã</div>
                <div class="subject-group">
                  <div class="input-wrapper">
                    <label for="russian" class="form-label muted">–†—É—Å—Å–∫–∏–π —è–∑—ã–∫</label>
                    <input type="number" class="form-control ege-input" id="russian" min="0" max="100"
                      placeholder="0-100" required>
                  </div>
                </div>
                <div class="subject-group">
                  <div class="input-wrapper">
                    <label for="math" class="form-label muted">–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞</label>
                    <input type="number" class="form-control ege-input" id="math" min="0" max="100" placeholder="0-100"
                      required>
                  </div>
                </div>
              </div>

              <div class="col-md-6 mb-4">
                <div class="subject-header">üéØ –ü—Ä–µ–¥–º–µ—Ç—ã –ø–æ –≤—ã–±–æ—Ä—É</div>
                <div class="input-group-custom">
                  <div class="input-wrapper">
                    <label for="physics" class="form-label muted">–§–∏–∑–∏–∫–∞</label>
                    <input type="number" class="form-control ege-input" id="physics" min="0" max="100"
                      placeholder="0-100">
                  </div>
                  <div class="input-wrapper">
                    <label for="informatics" class="form-label muted">–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞</label>
                    <input type="number" class="form-control ege-input" id="informatics" min="0" max="100"
                      placeholder="0-100">
                  </div>
                  <div class="input-wrapper">
                    <label for="chemistry" class="form-label muted">–•–∏–º–∏—è</label>
                    <input type="number" class="form-control ege-input" id="chemistry" min="0" max="100"
                      placeholder="0-100">
                  </div>
                </div>
                <div class="input-group-custom mt-3">
                  <div class="input-wrapper">
                    <label for="biology" class="form-label muted">–ë–∏–æ–ª–æ–≥–∏—è</label>
                    <input type="number" class="form-control ege-input" id="biology" min="0" max="100"
                      placeholder="0-100">
                  </div>
                  <div class="input-wrapper">
                    <label for="geography" class="form-label muted">–ì–µ–æ–≥—Ä–∞—Ñ–∏—è</label>
                    <input type="number" class="form-control ege-input" id="geography" min="0" max="100"
                      placeholder="0-100">
                  </div>
                  <div class="input-wrapper">
                    <label for="social" class="form-label muted">–û–±—â–µ—Å—Ç–≤–æ–∑–Ω–∞–Ω–∏–µ</label>
                    <input type="number" class="form-control ege-input" id="social" min="0" max="100"
                      placeholder="0-100">
                  </div>
                </div>
              </div>
            </div>

            <div class="row mt-4">
              <div class="col-12">
                <div class="subject-header">üèÜ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è (–¥–æ +10 –±–∞–ª–ª–æ–≤)</div>
                <div class="bonus-item">
                  <div class="form-check">
                    <input class="form-check-input bonus-checkbox" type="checkbox" id="gto" data-points="2">
                    <label class="form-check-label" for="gto">
                      –ó–æ–ª–æ—Ç–æ–π –∑–Ω–∞–∫ –ì–¢–û <span class="bonus-points">+2 –±–∞–ª–ª–∞</span>
                    </label>
                  </div>
                </div>
                <div class="bonus-item">
                  <div class="form-check">
                    <input class="form-check-input bonus-checkbox" type="checkbox" id="volunteer" data-points="1">
                    <label class="form-check-label" for="volunteer">
                      –í–æ–ª–æ–Ω—Ç–µ—Ä—Å–∫–∞—è –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å <span class="bonus-points">+1 –±–∞–ª–ª</span>
                    </label>
                  </div>
                </div>
                <div class="bonus-item">
                  <div class="form-check">
                    <input class="form-check-input bonus-checkbox" type="checkbox" id="olympiad" data-points="3">
                    <label class="form-check-label" for="olympiad">
                      –ü–æ–±–µ–¥–∏—Ç–µ–ª—å –æ–ª–∏–º–ø–∏–∞–¥—ã <span class="bonus-points">+3 –±–∞–ª–ª–∞</span>
                    </label>
                  </div>
                </div>
                <div class="bonus-item">
                  <div class="form-check">
                    <input class="form-check-input bonus-checkbox" type="checkbox" id="essay" data-points="5">
                    <label class="form-check-label" for="essay">
                      –ò—Ç–æ–≥–æ–≤–æ–µ —Å–æ—á–∏–Ω–µ–Ω–∏–µ <span class="bonus-points">+5 –±–∞–ª–ª–æ–≤</span>
                    </label>
                  </div>
                </div>
                <div class="bonus-item">
                  <div class="form-check">
                    <input class="form-check-input bonus-checkbox" type="checkbox" id="portfolio" data-points="2">
                    <label class="form-check-label" for="portfolio">
                      –ü–æ—Ä—Ç—Ñ–æ–ª–∏–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π <span class="bonus-points">+2 –±–∞–ª–ª–∞</span>
                    </label>
                  </div>
                </div>
                <div class="mt-3">
                  <small class="muted">* –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –±–∞–ª–ª–æ–≤: 10</small>
                </div>
              </div>
            </div>

            <div class="text-center mt-4">
              <button type="submit" class="btn btn-vgu btn-lg px-5">–ü–æ–¥–æ–±—Ä–∞—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</section>

<section id="results" class="results-section" style="display: none;">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-12">
        <div class="text-center mb-5 reveal">
          <h2 class="section-title">–ü–æ–¥—Ö–æ–¥—è—â–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h2>
          <div id="totalScoreDisplay" class="total-score"></div>
          <p class="muted">–ù–∞ –æ—Å–Ω–æ–≤–µ –≤–∞—à–∏—Ö –±–∞–ª–ª–æ–≤ –ï–ì–≠ –º—ã –ø–æ–¥–æ–±—Ä–∞–ª–∏ —Å–ª–µ–¥—É—é—â–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏</p>
          <div class="accent-underline"></div>
        </div>
      </div>

      <div class="col-lg-10">
        <div id="programsList" class="row g-4">
        </div>

        <div class="text-center mt-5 pt-4">
          <a href="/cources" class="btn btn-vgu btn-lg px-5">–£–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ –ø—Ä–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è</a>
        </div>
      </div>
    </div>
  </div>
</section>
</main>

<script src="https:
<script>


  document.getElementById('egeCalculatorForm').addEventListener('submit', async function (e) {
    e.preventDefault();

    const scores = {
      russian_lang: parseInt(document.getElementById('russian').value) || 0,
      math: parseInt(document.getElementById('math').value) || 0,
      physics: parseInt(document.getElementById('physics').value) || 0,
      it: parseInt(document.getElementById('informatics').value) || 0,
      chemistry: parseInt(document.getElementById('chemistry').value) || 0,
      geography: parseInt(document.getElementById('geography').value) || 0,
      sosial: parseInt(document.getElementById('social').value) || 0,

    };

    if (scores.russian === 0 || scores.math === 0) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –±–∞–ª–ª—ã –ø–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º –ø—Ä–µ–¥–º–µ—Ç–∞–º (–†—É—Å—Å–∫–∏–π —è–∑—ã–∫ –∏ –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞)');
      return;
    }

    const suitablePrograms = await findSuitablePrograms(scores);


    displayResults(suitablePrograms);

    document.getElementById('results').scrollIntoView({behavior: 'smooth'});
  });


  async function findSuitablePrograms(scores) {
    let request = " /api/get-avalable-cources?"; let ball_ctn=0; for (key in scores) { if (scores[key]> 40) {
        ball_ctn += scores[key];
        request += `${key}=1&`;
      }
    }
      request += `ball_ctn=${ball_ctn}`;
      let resp = await fetch(request).then(response => {
        return response.json();
      })

      let bonusPoints = 0;
      const bonusCheckboxes = document.querySelectorAll('.bonus-checkbox:checked');
      bonusCheckboxes.forEach(checkbox => {
        bonusPoints += parseInt(checkbox.getAttribute('data-points'));
      });

      bonusPoints = Math.min(bonusPoints, 10);

      ball_ctn += bonusPoints;

      const totalScoreDisplay = document.getElementById('totalScoreDisplay');

      totalScoreDisplay.innerHTML = `üéØ –í–∞—à –æ–±—â–∏–π –±–∞–ª–ª: <strong>${ball_ctn}</strong> (–ï–ì–≠: ${ball_ctn - bonusPoints} + –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: ${bonusPoints})`;
      return resp
  }

      function getSubjectKey(subjectName) {
        const mapping = {
          '–§–∏–∑–∏–∫–∞': 'physics',
          '–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞': 'informatics',
          '–•–∏–º–∏—è': 'chemistry',
          '–ë–∏–æ–ª–æ–≥–∏—è': 'biology',
          '–ì–µ–æ–≥—Ä–∞—Ñ–∏—è': 'geography',
          '–û–±—â–µ—Å—Ç–≤–æ–∑–Ω–∞–Ω–∏–µ': 'social'
        };
        return mapping[subjectName] || subjectName.toLowerCase();
      }


      function displayResults(suitablePrograms) {
        const resultsContainer = document.getElementById('programsList');
        const resultsSection = document.getElementById('results');

        if (suitablePrograms.length === 0) {
          resultsContainer.innerHTML = `
        <div class="col-12 text-center">
          <div class="glass-card p-5">
            <h4 class="text-warning mb-3">üòî –ü–æ–¥—Ö–æ–¥—è—â–∏—Ö –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h4>
            <p class="muted">–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –ø–æ –≤–∞—à–∏–º –±–∞–ª–ª–∞–º –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π.</p>
            <p class="muted">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —É–ª—É—á—à–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ï–ì–≠ –∏–ª–∏ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –¥—Ä—É–≥–∏–µ –ø—Ä–µ–¥–º–µ—Ç—ã.</p>
          </div>
        </div>
      `;
        } else {
          resultsContainer.innerHTML = suitablePrograms.map(program => `
        <div class="col-md-6 col-lg-4">
          <div class="glass-card program-card p-4 h-100">
            <div class="d-flex justify-content-between align-items-start mb-3">
              <h5 class="mb-0 flex-grow-1 me-3">${program.title}</h5>
              <span class="match-badge">${program.c_ball}</span>
            </div>
            <div class="score-display">–ü—Ä–æ—Ö–æ–¥–Ω–æ–π –±–∞–ª–ª: ${program.c_ball}</div>
            <div class="mt-3 pt-3 border-top border-secondary">
              <small class="text-success">‚úÖ –í—ã –ø—Ä–æ—Ö–æ–¥–∏—Ç–µ –ø–æ –±–∞–ª–ª–∞–º</small>
            </div>
          </div>
        </div>
      `).join('');
        }

        resultsSection.style.display = 'block';


        setTimeout(() => {
          document.querySelectorAll('#programsList .glass-card').forEach((card, index) => {
            setTimeout(() => {
              card.classList.add('reveal', 'in-view');
            }, index * 100);
          });
        }, 100);
      }


      const observer = new IntersectionObserver((entries) => {
        entries.forEach(e => {
          if (e.isIntersecting) e.target.classList.add('in-view');
        });
      }, {threshold: 0.1});

      document.querySelectorAll('.reveal').forEach(el => observer.observe(el));


      window.addEventListener('scroll', () => {
        const header = document.querySelector('.site-header');
        if (window.scrollY > 50) {
          header.classList.add('scrolled');
        } else {
          header.classList.remove('scrolled');
        }
      });
    </script>
{% endblock %}
